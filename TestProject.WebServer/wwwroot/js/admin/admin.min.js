angular.module("admin-app",[]).controller("admin-ctrl",function(n,t){function i(t,i){this.userName=t;this.email=i;this.customRoles=n.customRolesList}n.isLoading=!1;n.users=[];n.allCustomRoles=[];n.customRoles=[];n.allAppRoles=[];n.selectedUser=null;n.selectedCustomRole=null;n.onLoadCallbacks=[];n.getUsers=function(){n.isLoading=!0;t.get("/admin/getusers").then(function(t){t.data.success?(n.users=t.data.response.users,n.customRolesList=t.data.response.roles):toastModule.error({bodyText:t.data.response.errorMessage});n.isLoading=!1},function(t){toastModule.error({bodyText:t.data.response.errorMessage});n.isLoading=!1})};n.onLoadCallbacks.push(n.getUsers);n.getRoles=function(){n.isLoading=!0;t.get("/admin/getroles").then(function(t){t.data.success?(n.customRoles=t.data.response.roles,n.allAppRoles=t.data.response.appRoles,toastModule.succes({bodyText:t.data.response.message})):toastModule.error({bodyText:t.data.response.errorMessage});n.isLoading=!1},function(t){toastModule.error({bodyText:t.data.response.errorMessage});n.isLoading=!1})};n.addNew=function(){const t=new i("New user");n.users.unshift(t);n.selectUser(t)};n.updateUser=function(){n.isLoading=!0;n.selectedUser.id?t.post("/admin/updateuser",n.selectedUser).then(function(t){t.data.success?toastModule.succes({bodyText:t.data.message}):toastModule.error({bodyText:t.data.errorMessage});n.isLoading=!1}).catch(function(n){toastModule.error({bodyText:n.data.errorMessage})}):t.post("/Admin/AddUser",n.selectedUser).then(function(t){t.data.success?(Object.assign(n.selectedUser,t.data.response,{isChanged:!1}),toastModule.succes({bodyText:t.data.message})):toastModule.error({bodyText:t.data.errorMessage});n.isLoading=!1},function(){n.isLoading=!1})};n.selectUser=function(t){n.selectedUser!==t&&(n.selectedUser&&(n.selectedUser.isSelected=!1),n.selectedUser=t,n.selectedUser.isSelected=!0,n.selectedUser.hasError={},n.selectedUser.userId===""&&(n.selectedUser.isChanged=!0))};n.selectCustomRole=function(t){n.selectedCustomRole!==t&&(n.selectedCustomRole&&(n.selectedCustomRole.isSelected=!1),n.selectedCustomRole=t,n.selectedCustomRole.isSelected=!0,n.selectedCustomRole.hasError={},n.selectedUser.id===""&&(n.selectedUser.isChanged=!0))};n.updateCustomRole=function(){n.selectCustomRole.id};n.onLoadCallbacks.forEach(function(n){n()})});